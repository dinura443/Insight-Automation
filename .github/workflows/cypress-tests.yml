name: Cypress Tests

on:
  workflow_dispatch:
    inputs:
      username:
        description: 'Username for Superset instances'
        required: true
      password:
        description: 'Password for Superset instances'
        required: true
      dashboard_name:
        description: 'Name of the dashboard to test'
        required: true
      instance1_login:
        description: 'Login URL for Instance 1'
        required: true
      instance2_login:
        description: 'Login URL for Instance 2'
        required: true
      instance1_dashboard:
        description: 'Dashboard URL for Instance 1'
        required: true
      instance2_dashboard:
        description: 'Dashboard URL for Instance 2'
        required: true

jobs:
  cypress-run:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v3

      - name: Set up Node.js
        uses: actions/setup-node@v3
        with:
          node-version: 18

      - name: Install Dependencies
        run: npm install

      - name: Create Temporary Directory
        run: mkdir -p ./temp/{downloads,fixtures,dashboard_instance1,dashboard_instance2,UIComponents,backups}

      - name: Run Cypress Tests
        env:
          USERNAME: ${{ inputs.username }}
          PASSWORD: ${{ inputs.password }}
          DASHBOARD_NAME: ${{ inputs.dashboard_name }}
          INSTANCE1_LOGIN: ${{ inputs.instance1_login }}
          INSTANCE2_LOGIN: ${{ inputs.instance2_login }}
          INSTANCE1_DASHBOARD: ${{ inputs.instance1_dashboard }}
          INSTANCE2_DASHBOARD: ${{ inputs.instance2_dashboard }}
          ROOT_DIR: ./temp
          DOWNLOAD_DIR: ./temp/downloads
          FIXTURES_DIR: ./temp/fixtures
          DASHBOARD_INSTANCE1: ./temp/dashboard_instance1
          DASHBOARD_INSTANCE2: ./temp/dashboard_instance2
          DASHBOARD_UI: ./temp/UIComponents
          BACKUP_DIR: ./temp/backups
        run: npx cypress run

     

